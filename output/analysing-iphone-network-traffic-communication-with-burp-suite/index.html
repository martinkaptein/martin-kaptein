<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>analysing-iphone-network-traffic-communication</title><meta name="description" content="A tutorial and research on how to analyse all the network traffic communication, packet by packet, send from your iPhone using Burp suite."><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://www.martinkaptein.com/analysing-iphone-network-traffic-communication-with-burp-suite/"><link rel="amphtml" href="https://www.martinkaptein.com/amp/analysing-iphone-network-traffic-communication-with-burp-suite/"><link type="application/atom+xml" rel="alternate" href="https://www.martinkaptein.com/feed.xml"><meta property="og:title" content="Analysing iPhone network traffic communication with Burp suite"><meta property="og:image" content="https://www.martinkaptein.com/media/posts/13/burp4.jpg"><meta property="og:site_name" content="Martin Kaptein - My website"><meta property="og:description" content="A tutorial and research on how to analyse all the network traffic communication, packet by packet, send from your iPhone using Burp suite."><meta property="og:url" content="https://www.martinkaptein.com/analysing-iphone-network-traffic-communication-with-burp-suite/"><meta property="og:type" content="article"><meta property="fb:app_id" content="650663772029023"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@martinkaptein"><meta name="twitter:title" content="Analysing iPhone network traffic communication with Burp suite"><meta name="twitter:description" content="A tutorial and research on how to analyse all the network traffic communication, packet by packet, send from your iPhone using Burp suite."><meta name="twitter:image" content="https://www.martinkaptein.com/media/posts/13/burp4.jpg"><link rel="shortcut icon" href="https://www.martinkaptein.com/media/website/favicon.ico" type="image/x-icon"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto:400,700%7CRoboto+Condensed:400,700&amp;subset=latin-ext" rel="stylesheet"><link rel="stylesheet" href="https://www.martinkaptein.com/assets/css/style.css?v=29fb2c34ce81d9af93f9cd10912b2c30"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.martinkaptein.com/analysing-iphone-network-traffic-communication-with-burp-suite/"},"headline":"Analysing iPhone network traffic communication with Burp suite","datePublished":"2019-04-22T12:52","dateModified":"2019-04-22T12:52","image":{"@type":"ImageObject","url":"https://www.martinkaptein.com/media/posts/13/burp4.jpg","height":541,"width":800},"description":"In this blog post we are going to explore how to analyse all the network traffic communication, packet by packet, send from your iPhone. For this we are going to use Burp. This will allow us to gain insight on how apps interact with API’s,&hellip;","author":{"@type":"Person","name":"Martin Kaptein"},"publisher":{"@type":"Organization","name":"Martin Kaptein","logo":{"@type":"ImageObject","url":"https://www.martinkaptein.com/media/website/logo.png","height":705,"width":705}}}</script><script async src="https://www.martinkaptein.com/assets/js/lazysizes.min.js?v=fcb7109aacc796048242935c33a7f9ab"></script><style>.top__search [type=search] {
						background-image: url(https://www.martinkaptein.com/assets/svg/search.svg);
				    }</style><script async src="https://www.googletagmanager.com/gtag/js?id=UA-86096566-3"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-86096566-3');</script></head><body><div class="container"><header class="js-top is-sticky"><a class="logo" href="https://www.martinkaptein.com"><img src="https://www.martinkaptein.com/media/website/logo.png" alt="Martin Kaptein"></a><div class="top"><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"><li><a href="https://www.martinkaptein.com/about/" target="_self">About</a></li><li><a href="https://www.martinkaptein.com/contact/" target="_self">Contact</a></li><li><a href="https://www.martinkaptein.com/piano-and-music-theory-lessons/" target="_self">Music lessons (English)</a></li><li><a href="https://www.martinkaptein.com/piano-lessen-en-muziek-theorie-lessen/" target="_self">Muziek lessen (Nederlands)</a></li><li><a href="https://www.martinkaptein.com/computer-hulp-en-bouw-van-websites/" target="_self">IT diensten (Nederlands)</a></li></ul></nav><div class="top__search"><form action="https://www.martinkaptein.com/search.html" class="search"><input type="search" name="q" placeholder="search..."></form></div></div></header><main><article class="post"><div class="hero"><div class="hero__wrap"><img src="https://www.martinkaptein.com/media/posts/13/burp4.jpg" sizes="(max-width: 1600px) 100vw, 1600px" srcset="https://www.martinkaptein.com/media/posts/13/responsive/burp4-xs.jpg 300w, https://www.martinkaptein.com/media/posts/13/responsive/burp4-sm.jpg 480w, https://www.martinkaptein.com/media/posts/13/responsive/burp4-md.jpg 768w, https://www.martinkaptein.com/media/posts/13/responsive/burp4-lg.jpg 1024w, https://www.martinkaptein.com/media/posts/13/responsive/burp4-xl.jpg 1360w, https://www.martinkaptein.com/media/posts/13/responsive/burp4-2xl.jpg 1600w" alt="burp suite in action"></div><header class="hero__text"><h1>Analysing iPhone network traffic communication with Burp suite</h1><p class="post__meta"><time datetime="2019-04-22T12:52">April 22, 2019 </time>By <a href="https://www.martinkaptein.com/authors/martinkaptein/" rel="author" title="Martin Kaptein">Martin Kaptein</a></p></header></div><div class="post__entry"><p>In this blog post we are going to explore how to analyse all the network traffic communication, packet by packet, send from your iPhone. For this we are going to use Burp.</p><p>This will allow us to gain insight on how apps interact with API’s, which data they are sending and much more. It’s fascinating to see what happens in the background the moment you open an app.</p><p>In my <a href="../old-tech-vs-new-tech-casio-vs-xiaomi/">previous post</a> I have already hinted at my dissatisfaction on seeing how much analytics data is shared about you.</p><p>After this tutorial, you’ll be able to find this out for yourself. Let’s go!</p><p>If you are interested how an iPhone app interacts with the Internet, this post is for you.</p><h2>The setup</h2><p>For this tutorial/research we are going to pipe all the network traffic from the iPhone through a proxy server on our computer. We will also need to install certificates (which you can remove later) on the iPhone to allow HTTPS communication.</p><p>This is also the reason, I believe, this tutorial won’t apply to android devices, as the latest android versions don’t allow root certificate installation.</p><p>This tutorial was made using an iPhone running iOS 11, but other versions will (or should) work just fine, just with slightly different steps.</p><h2>Installing the necessary software</h2><p>On your computer, go ahead and download and install the <a href="https://portswigger.net/burp/communitydownload">Burp Suite Community Edition here</a> (it’s completely free). Also, it should work on all platforms.</p><p>Also, make sure, that your devices are on the same network.</p><h2>Starting the proxy server</h2><p>Start Burp suite community edition. You can select <em>temporary project</em> for now, and use Burp defaults.</p><p>In the Task bar head over to Proxy, then, inside, click on options.</p><p>Add a new proxy listener, bind to any port that is not currently in use. I will use port <code>8121</code>. Make sure the check all interfaces.</p><p>It should look like this:</p><figure class="post__image"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/13/responsive/burp1-xs.jpg" data-sizes="auto" data-srcset="https://www.martinkaptein.com/media/posts/13/responsive/burp1-xs.jpg 300w ,https://www.martinkaptein.com/media/posts/13/responsive/burp1-sm.jpg 480w ,https://www.martinkaptein.com/media/posts/13/responsive/burp1-md.jpg 768w" alt="Burp suite screenshot 1" width="472" height="282"></figure><p><em>Burp screenshot 1</em></p><p>After that accept the warning messages.</p><p>We’ll leave the rest of the option in their default state for now.</p><p>This is how it will look:</p><figure class="post__image"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/13/responsive/burp2-xs.jpg" data-sizes="auto" data-srcset="https://www.martinkaptein.com/media/posts/13/responsive/burp2-xs.jpg 300w ,https://www.martinkaptein.com/media/posts/13/responsive/burp2-sm.jpg 480w ,https://www.martinkaptein.com/media/posts/13/responsive/burp2-md.jpg 768w" alt="Burp suite screenshot 2" width="617" height="423"></figure><p><em>Burp screenshot 2</em></p><p>Now, grab your iPhone.</p><h2>Connecting the iPhone</h2><p>Now, we will need to pipe the network of your iPhone through the proxy server.</p><p>For this, type in the terminal/command line your computer <code>ifconfig</code>, to find out your IP address on the internal network.</p><figure class="post__image"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/13/responsive/burp3-xs.jpg" data-sizes="auto" data-srcset="https://www.martinkaptein.com/media/posts/13/responsive/burp3-xs.jpg 300w ,https://www.martinkaptein.com/media/posts/13/responsive/burp3-sm.jpg 480w ,https://www.martinkaptein.com/media/posts/13/responsive/burp3-md.jpg 768w" alt="Terminal screenshot ifconfig" width="579" height="539"></figure><p><em>Terminal screenshot ifconfig</em></p><p>As you can see on this screenshot, my internal IP address is <code>192.168.178.97</code>.</p><p>Take note of your address.</p><p>On your iPhone, go to settings &gt;&gt; Wi-Fi. To the right of the network name, press the (i) icon. Then scroll down, press on <em>Configure Proxy</em>, and go to manual.</p><p>For server enter the address you just noted. In the port enter your port. Leave the Authentication off.</p><p>It should look something like this:</p><figure class="post__image"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-1-xs.jpg" data-sizes="auto" data-srcset="https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-1-xs.jpg 300w ,https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-1-sm.jpg 480w ,https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-1-md.jpg 768w" alt="iPhone screenshot 1, proxy settings" width="400" height="710"></figure><p><em>iPhone screenshot 1, proxy</em></p><p>Now we will install the necessary certificate on your iPhone.</p><h2>Installing the certificate</h2><p>Your iPhone is now connected to your proxy server.</p><p>We need to install the certificates to allow opening of HTTPS sites. This is taken from the <a href="https://support.portswigger.net/customer/portal/articles/1841109-installing-burp-s-ca-certificate-in-an-ios-device">official burp iPhone tutorial</a>.</p><p>Open Safari and in the address bar enter: <code>http://burp</code>.</p><figure class="post__image"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-2-xs.jpg" data-sizes="auto" data-srcset="https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-2-xs.jpg 300w ,https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-2-sm.jpg 480w ,https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-2-md.jpg 768w" alt="Burp suite iPhone safari" width="400" height="710"></figure><p><em>iPhone screenshot 2, burp</em></p><p>On the right corner click on CA Certificate, and allow the setup of the configuration profile.</p><p>Click Allow, then Install, enter passcode, click install and allow again.</p><figure class="post__image"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-3-xs.jpg" data-sizes="auto" data-srcset="https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-3-xs.jpg 300w ,https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-3-sm.jpg 480w ,https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-3-md.jpg 768w" alt="iPhone certificate install screen" width="400" height="710"></figure><p><em>iPhone screenshot 3, certificate</em></p><p>After that head over to settings again, go to Settings &gt;&gt; General &gt;&gt; About &gt;&gt; <em>scroll down</em> &gt;&gt; Certificate Trust Settings &gt;&gt; <em>activate the root certificate</em> (PortSwigger CA). Press continue.</p><figure class="post__image"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-4-xs.jpg" data-sizes="auto" data-srcset="https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-4-xs.jpg 300w ,https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-4-sm.jpg 480w ,https://www.martinkaptein.com/media/posts/13/responsive/ip-scr-4-md.jpg 768w" alt="iPhone certificate trust settings screenshot" width="400" height="710"></figure><p><em>iPhone screenshot 4, certificate root</em></p><p>Now, we can finally begin analysing the network traffic which is coming from the iPhone.</p><p><strong>Note:</strong> At any time you can (and should) remove the Certificates from your iPhone, once you are finished analysing. For this, just head over to Settings &gt;&gt; General &gt;&gt; Profiles (…) and remove the configuration profile.</p><h2>Intercepting packets from your iPhone with Burp Suite</h2><p>Now, you can see ALL the traffic that is send from your iPhone.</p><p>On your computer open the intercept Tab (inside the Proxy tab), there you will see all the packets that are being send from your iPhone, one by one.</p><figure class="post__image post__image"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/13/responsive/burp4-xs.jpg" data-sizes="auto" data-srcset="https://www.martinkaptein.com/media/posts/13/responsive/burp4-xs.jpg 300w ,https://www.martinkaptein.com/media/posts/13/responsive/burp4-sm.jpg 480w ,https://www.martinkaptein.com/media/posts/13/responsive/burp4-md.jpg 768w" alt="Burp suite intercepting network traffic" width="800" height="541"><figcaption>burp suite intercepting network traffic</figcaption></figure><p> </p><p><em>Burp screenshot 4, intercepting traffic</em></p><p>Of course, I won’t post screenshots which contain sensitive information (which you will see in Burp, please be aware).</p><p>Press on the Forward button to continue sending the packets, or Drop to drop them (duh).</p><p>Try opening various apps, and identify their packets.</p><p>You will be surprised to see, how much is being send.</p><h2>Conclusion</h2><p>You will wonder: So what?</p><p>This method is aimed at people who wonder how stuff works (I suppose you do, since you read my blog post until here). This method provides deep insight how apps work, since you can trace every packet they send.</p><p>You can assume, how their API’s work, deduct how the application is written.</p><p>For example, you can see exactly how the flight tracking app “Flightradar24” renders it’s map, and receives information. And there are countless more examples of interesting stuff happening.</p><p>I really find it amazing how much is happening in the background while we are taking everything for granted.</p><p>Let this post, fuel your imagination of all the things possible:)</p><h2>PS</h2><p>Don’t forget to remove the Proxy server configuration, otherwise you will not be able to connect to the internet.</p><p class="post__last-updated">This article was updated on April 22, 2019</p></div><aside class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.martinkaptein.com%2Fanalysing-iphone-network-traffic-communication-with-burp-suite%2F" class="js-share facebook" title="Share with Facebook" rel="nofollow"><svg class="icon"><use xlink:href="https://www.martinkaptein.com/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fwww.martinkaptein.com%2Fanalysing-iphone-network-traffic-communication-with-burp-suite%2F&amp;via=%40MartinKaptein&amp;text=Analysing%20iPhone%20network%20traffic%20communication%20with%20Burp%20suite" class="js-share twitter" title="Share with Twitter" rel="nofollow"><svg class="icon"><use xlink:href="https://www.martinkaptein.com/assets/svg/svg-map.svg#twitter"/></svg></a></aside><footer class="post__footer"><ul class="post__tag"><li><a href="https://www.martinkaptein.com/tags/blog/">Blog</a></li><li><a href="https://www.martinkaptein.com/tags/tech/">Technology</a></li></ul><div class="post__bio"><img src="https://www.martinkaptein.com/media/website/martin-kaptein-hero-copy.JPG" alt="Martin Kaptein"><h3><a href="https://www.martinkaptein.com/authors/martinkaptein/" class="inverse" title="Martin Kaptein">Martin Kaptein</a></h3><p>Martin Kaptein is the author on the website on martinkaptein.com.</p></div><nav class="post__nav"><div class="post__nav__prev">Previous Post<h5><a href="https://www.martinkaptein.com/analysing-quote-life-is-paradoxically-coincidental/" class="inverse" rel="prev">Analysing a Quote</a></h5></div><div class="post__nav__next">Next Post<h5><a href="https://www.martinkaptein.com/opinion-about-modular-phones/" class="inverse" rel="next">My Opinion about modular phones</a></h5></div></nav><div class="post__related"><h3>Related posts</h3><div class="post__related__wrap"><figure><a href="https://www.martinkaptein.com/10-reasons-casio-f-91w-best-watch/"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/3/responsive/with-casio-f91w-xs.jpg" data-srcset="https://www.martinkaptein.com/media/posts/3/responsive/with-casio-f91w-xs.jpg" data-expand="300" alt="Casio F-91W in action"></a><figcaption><h4><a href="https://www.martinkaptein.com/10-reasons-casio-f-91w-best-watch/" class="inverse">10 Reasons the Casio F-91W is the best watch in the world</a></h4><time datetime="2019-04-21T12:27">April 21, 2019</time></figcaption></figure><figure><a href="https://www.martinkaptein.com/using-a-nexus-4-in-2018/"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/4/responsive/ubports-terminal-xs.jpg" data-srcset="https://www.martinkaptein.com/media/posts/4/responsive/ubports-terminal-xs.jpg" data-expand="300" alt="Ubports running on the Nexus 4"></a><figcaption><h4><a href="https://www.martinkaptein.com/using-a-nexus-4-in-2018/" class="inverse">Using a Nexus 4 in 2018</a></h4><time datetime="2019-04-21T16:16">April 21, 2019</time></figcaption></figure><figure><a href="https://www.martinkaptein.com/ubuntu-touch-on-nexus-4-in-2018-installation-and-review/"><img class="lazyload" src="https://www.martinkaptein.com/media/posts/5/responsive/ubuntu-touch-nexus-4-xs.jpg" data-srcset="https://www.martinkaptein.com/media/posts/5/responsive/ubuntu-touch-nexus-4-xs.jpg" data-expand="300" alt="ubports running on the nexus 4"></a><figcaption><h4><a href="https://www.martinkaptein.com/ubuntu-touch-on-nexus-4-in-2018-installation-and-review/" class="inverse">Ubuntu Touch on the LG Nexus 4 in 2018 - the painful installation and review</a></h4><time datetime="2019-04-21T16:23">April 21, 2019</time></figcaption></figure></div></div></footer></article><h3>Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
              this.page.url = 'https://www.martinkaptein.com/analysing-iphone-network-traffic-communication-with-burp-suite/';
      		this.page.identifier = '13';
              this.page.title = ' analysing-iphone-network-traffic-communication';
          };
      
          var disqus_loaded = false;
      
          function publiiLoadDisqus() {
              if(disqus_loaded) {
                  return false;
              }
      
              var top = document.getElementById('disqus_thread').offsetTop;
      
              if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                  disqus_loaded = true;
      
                  (function () {
                      var d = document, s = d.createElement('script');
                      s.src = '//martinkaptein.disqus.com/embed.js';
                      s.setAttribute('data-timestamp', +new Date());
                      (d.head || d.body).appendChild(s);
                  })();
              }
          }
      
          publiiLoadDisqus();
      
          window.onscroll = function() {
              publiiLoadDisqus();
          };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></main><footer class="footer"><div class="footer__social"><a href="https://www.facebook.com/martin.kaptein" aria-label="Facebook"><svg class="icon"><use xlink:href="https://www.martinkaptein.com/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/MartinKaptein/" aria-label="Twitter"><svg class="icon"><use xlink:href="https://www.martinkaptein.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/martinkaptein/" aria-label="Instagram"><svg class="icon"><use xlink:href="https://www.martinkaptein.com/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://linkedin.com/in/martin-kaptein-a26661159" aria-label="LinkedIn"><svg class="icon"><use xlink:href="https://www.martinkaptein.com/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://www.youtube.com/channel/UCosUIzMUriRTgg60vh3EwCQ" aria-label="Youtube"><svg class="icon"><use xlink:href="https://www.martinkaptein.com/assets/svg/svg-map.svg#youtube"/></svg></a></div><div class="footer__copyright">copyright 2019 Martin Kaptein</div></footer></div><script defer="defer" src="https://www.martinkaptein.com/assets/js/jquery-3.2.1.slim.min.js?v=5f48fc77cac90c4778fa24ec9c57f37d"></script><script defer="defer" src="https://www.martinkaptein.com/assets/js/scripts.min.js?v=5dffffceea1fdc07740088873ba7ff09"></script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>This website uses cookies and Google Analytics</h2><p>Select which cookies to opt-in to via the checkboxes below; our website uses cookies and Google Analytics to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. This website uses cookies to ensure you get the best experience on our site and to provide a comment feature. To analyze our traffic, we use basic Google Analytics implementation with anonymized data. If you continue without changing your settings, we'll assume that you are happy to receive all cookies on the website of Martin Kaptein. To understand more about how we use cookies, or for information on how to change your cookie settings, please see our Privacy Policy. <a href="https://www.martinkaptein.com/privacy-policy/">More details...</a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Required</label> <input id="gdpr-functions" name="gdpr-functions" type="checkbox"> <label for="gdpr-functions">Functionality</label> <input id="gdpr-analytics" name="gdpr-analytics" type="checkbox"> <label for="gdpr-analytics">Analytical</label> <input id="gdpr-marketing" name="gdpr-marketing" type="checkbox"> <label for="gdpr-marketing">Marketing</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Save</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>