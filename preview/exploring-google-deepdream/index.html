<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Exploring Google DeepDream and getting nice images - Martin Kaptein</title><meta name="description" content="Exploring Google DeepDream and getting very cool results. My experiences and modifications to the source code."><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/exploring-google-deepdream/"><link rel="amphtml" href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/amp/exploring-google-deepdream/"><link type="application/atom+xml" rel="alternate" href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/feed.xml"><meta property="og:title" content="Exploring Google DeepDream and getting nice images"><meta property="og:image" content="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/inc5aoutx123.jpg"><meta property="og:site_name" content="Martin Kaptein - My website"><meta property="og:description" content="Exploring Google DeepDream and getting very cool results. My experiences and modifications to the source code."><meta property="og:url" content="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/exploring-google-deepdream/"><meta property="og:type" content="article"><meta property="fb:app_id" content="650663772029023"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@martinkaptein"><meta name="twitter:title" content="Exploring Google DeepDream and getting nice images"><meta name="twitter:description" content="Exploring Google DeepDream and getting very cool results. My experiences and modifications to the source code."><meta name="twitter:image" content="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/inc5aoutx123.jpg"><link rel="shortcut icon" href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/website/favicon.ico" type="image/x-icon"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto:400,700%7CRoboto+Condensed:400,700&amp;subset=latin-ext" rel="stylesheet"><link rel="stylesheet" href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/css/style.css?v=29fb2c34ce81d9af93f9cd10912b2c30"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/exploring-google-deepdream/index.html"},"headline":"Exploring Google DeepDream and getting nice images","datePublished":"2019-04-28T17:04","dateModified":"2019-04-28T17:04","image":{"@type":"ImageObject","url":"file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/inc5aoutx123.jpg","height":231,"width":250},"description":"In this Blog post I would like to explore Google DeepDream and report about my experiences with it. Google DeepDream is an open source program, created by Google, which uses a convolutional neural networks (CNN's) to find and enhance patterns in images. This can lead&hellip;","author":{"@type":"Person","name":"Martin Kaptein"},"publisher":{"@type":"Organization","name":"Martin Kaptein","logo":{"@type":"ImageObject","url":"file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/website/logo.png","height":705,"width":705}}}</script><script async src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/js/lazysizes.min.js?v=fcb7109aacc796048242935c33a7f9ab"></script><style>.top__search [type=search] {
						background-image: url(file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/svg/search.svg);
				    }</style></head><body><div class="container"><header class="js-top is-sticky"><a class="logo" href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/index.html"><img src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/website/logo.png" alt="Martin Kaptein"></a><div class="top"><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"><li><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/about/index.html" target="_self">About</a></li><li><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/contact/index.html" target="_self">Contact</a></li><li><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/piano-and-music-theory-lessons/index.html" target="_self">Music lessons (English)</a></li></ul></nav><div class="top__search"><form action="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/search.html" class="search"><input type="search" name="q" placeholder="search..."></form></div></div></header><main><article class="post"><div class="hero"><div class="hero__wrap"><img src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/inc5aoutx123.jpg" sizes="(max-width: 1600px) 100vw, 1600px" srcset="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-xs.jpg 300w, file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-sm.jpg 480w, file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-md.jpg 768w, file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-lg.jpg 1024w, file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-xl.jpg 1360w, file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-2xl.jpg 1600w" alt="google deepdream interesting output"></div><header class="hero__text"><h1>Exploring Google DeepDream and getting nice images</h1><p class="post__meta"><time datetime="2019-04-28T17:04">April 28, 2019 </time>By <a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/authors/martinkaptein/index.html" rel="author" title="Martin Kaptein">Martin Kaptein</a></p></header></div><div class="post__entry"><p>In this Blog post I would like to explore Google DeepDream and report about my experiences with it.</p><h2>Introduction to Google DeepDream</h2><p>Google DeepDream is an <a href="https://github.com/google/deepdream">open source program, created by Google</a>, which uses a convolutional neural networks (CNN's) to find and enhance patterns in images.</p><p>This can lead to very cool-looking results.</p><p>What I like about Google DeepDream is that it provides a very visual approach and representation of an, otherwise, very abstract topic.</p><p>In this Blog post I will share some of my results and settings which I used.</p><h2>The source image</h2><p>I used an image (which I took myself) of clouds:</p><figure class="post__image"><img class="lazyload" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/cloudsw500-xs.jpg" data-sizes="auto" data-srcset="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/cloudsw500-xs.jpg 300w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/cloudsw500-sm.jpg 480w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/cloudsw500-md.jpg 768w" alt="cumulunimbus clouds" width="250" height="231"></figure><p><em>My source image, input for DeepDream</em></p><p>In my experience the image dimension should be somewhere between 700 pixels sq and 200 pixels sq (not necessarily square, of course). Large images take an extremely long time to process, but can also provide really beautiful results.</p><p>Also, the size of the <em>Dream stuff</em> doesn't scale with the image (probably depends on the trained model).</p><p>Intrestingly enough, images with clouds tend to be most interesting. Humans do also tend to interpret different things when looking at clouds, so that's a nice parallel.</p><h2>My results</h2><p>Here are some of my favourite results I got:</p><figure class="post__image"><img class="lazyload" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/cloudsw500inc4cout-xs.jpg" data-sizes="auto" data-srcset="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/cloudsw500inc4cout-xs.jpg 300w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/cloudsw500inc4cout-sm.jpg 480w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/cloudsw500inc4cout-md.jpg 768w" alt="google deepdream output" width="250" height="231"></figure><p><em>Default settings</em></p><p>This is done, basically with the default settings of Google (but used <strong>98 iterations</strong>)</p><pre><code>
make_step(net, step_size=1.5, end='inception_4c/output', jitter=32, clip=True, objective=objective_L2)
</code></pre><pre><code>
deepdream(net, base_img, iter_n=11, octave_n=4, octave_scale=1.4, 
          end='inception_4c/output', clip=True, **step_params)
</code></pre><figure class="post__image"><img class="lazyload" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc4bout-xs.jpg" data-sizes="auto" data-srcset="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc4bout-xs.jpg 300w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc4bout-sm.jpg 480w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc4bout-md.jpg 768w" alt="google deepdream output 2" width="250" height="231"></figure><p><em>Layer: end='inception_4b/output'</em></p><p>Whilst you can see in the first image more or less complete dogs, here it's more ears and eyes. This makes sense, as it's a 'lower level layer'.</p><figure class="post__image"><img class="lazyload" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-xs.jpg" data-sizes="auto" data-srcset="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-xs.jpg 300w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-sm.jpg 480w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5aoutx123-md.jpg 768w" alt="google deepdream output 3" width="250" height="231"></figure><p><em>Layer: end='inception_5a/output'</em></p><p>This yields a very abstract result. Probably my favourite. This particular picture <strong>used 123 iterations</strong> (more on that later).</p><figure class="post__image"><img class="lazyload" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5bout-xs.jpg" data-sizes="auto" data-srcset="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5bout-xs.jpg 300w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5bout-sm.jpg 480w ,file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/19/responsive/inc5bout-md.jpg 768w" alt="google deepdream inception output 5" width="250" height="231"></figure><p><em>Layer: end='inception_5b/output'</em></p><p>Well, I leave this one to you.</p><p><em>Note: I had to down-scale these images, so that this site loads a bit faster :P I hope that's ok</em></p><h2>Modifications to the source code</h2><p>The only modification I made was to 're-dream' every image (quite a large number of times).</p><p>This helps to get a more vivid result.</p><p>Here is the script I made (it saves every iteration, so you can make a nice .gif or something later). Also, it doesn't crash due to memory issues.</p><pre><code>
for i in xrange(somenumber):
    frame = deepdream(net, frame)
    PIL.Image.fromarray(np.uint8(frame)).save("output/%04d.jpg"%frame_i)
    frame = np.float32(PIL.Image.open('output/%04d.jpg'%frame_i))
    frame_i += 1
    
</code></pre><h2>Conclusion</h2><p>I personally like this topic very much. Will probably write other blog posts about this too (for example, about using different models).</p><p class="post__last-updated">This article was updated on April 28, 2019</p></div><aside class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=file%3A%2F%2F%2FUsers%2Fmkaptein172%2FDocuments%2FPublii%2Fsites%2Fmartin-kaptein%2Fpreview%2Fexploring-google-deepdream%2Findex.html" class="js-share facebook" title="Share with Facebook" rel="nofollow"><svg class="icon"><use xlink:href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=file%3A%2F%2F%2FUsers%2Fmkaptein172%2FDocuments%2FPublii%2Fsites%2Fmartin-kaptein%2Fpreview%2Fexploring-google-deepdream%2Findex.html&amp;via=%40MartinKaptein&amp;text=Exploring%20Google%20DeepDream%20and%20getting%20nice%20images" class="js-share twitter" title="Share with Twitter" rel="nofollow"><svg class="icon"><use xlink:href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/svg/svg-map.svg#twitter"/></svg></a></aside><footer class="post__footer"><ul class="post__tag"><li><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/tags/blog/index.html">Blog</a></li><li><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/tags/tech/index.html">Technology</a></li></ul><div class="post__bio"><img src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/website/martin-kaptein-hero-copy.JPG" alt="Martin Kaptein"><h3><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/authors/martinkaptein/index.html" class="inverse" title="Martin Kaptein">Martin Kaptein</a></h3><p>Martin Kaptein is the author on the website on martinkaptein.com.</p></div><nav class="post__nav"><div class="post__nav__prev">Previous Post<h5><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/the-beauty-of-computer-dreams/index.html" class="inverse" rel="prev">When computers see dreams - the essence of dreams</a></h5></div><div class="post__nav__next">Next Post<h5><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/pythoncms/index.html" class="inverse" rel="next">PythonCMS - A static blog and site generator</a></h5></div></nav><div class="post__related"><h3>Related posts</h3><div class="post__related__wrap"><figure><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/10-reasons-casio-f-91w-best-watch/index.html"><img class="lazyload" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/3/responsive/with-casio-f91w-xs.jpg" data-srcset="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/3/responsive/with-casio-f91w-xs.jpg" data-expand="300" alt="Casio F-91W in action"></a><figcaption><h4><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/10-reasons-casio-f-91w-best-watch/index.html" class="inverse">10 Reasons the Casio F-91W is the best watch in the world</a></h4><time datetime="2019-04-21T12:27">April 21, 2019</time></figcaption></figure><figure><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/using-a-nexus-4-in-2018/index.html"><img class="lazyload" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/4/responsive/ubports-terminal-xs.jpg" data-srcset="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/4/responsive/ubports-terminal-xs.jpg" data-expand="300" alt="Ubports running on the Nexus 4"></a><figcaption><h4><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/using-a-nexus-4-in-2018/index.html" class="inverse">Using a Nexus 4 in 2018</a></h4><time datetime="2019-04-21T16:16">April 21, 2019</time></figcaption></figure><figure><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/ubuntu-touch-on-nexus-4-in-2018-installation-and-review/index.html"><img class="lazyload" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/5/responsive/ubuntu-touch-nexus-4-xs.jpg" data-srcset="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/media/posts/5/responsive/ubuntu-touch-nexus-4-xs.jpg" data-expand="300" alt="ubports running on the nexus 4"></a><figcaption><h4><a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/ubuntu-touch-on-nexus-4-in-2018-installation-and-review/index.html" class="inverse">Ubuntu Touch on the LG Nexus 4 in 2018 - the painful installation and review</a></h4><time datetime="2019-04-21T16:23">April 21, 2019</time></figcaption></figure></div></div></footer></article><h3>Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
              this.page.url = 'file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/exploring-google-deepdream/index.html';
      		this.page.identifier = '19';
              this.page.title = ' Exploring Google DeepDream and getting nice images - Martin Kaptein ';
          };
      
          var disqus_loaded = false;
      
          function publiiLoadDisqus() {
              if(disqus_loaded) {
                  return false;
              }
      
              var top = document.getElementById('disqus_thread').offsetTop;
      
              if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                  disqus_loaded = true;
      
                  (function () {
                      var d = document, s = d.createElement('script');
                      s.src = '//martinkaptein.disqus.com/embed.js';
                      s.setAttribute('data-timestamp', +new Date());
                      (d.head || d.body).appendChild(s);
                  })();
              }
          }
      
          publiiLoadDisqus();
      
          window.onscroll = function() {
              publiiLoadDisqus();
          };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></main><footer class="footer"><div class="footer__social"><a href="https://www.facebook.com/martin.kaptein" aria-label="Facebook"><svg class="icon"><use xlink:href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/MartinKaptein/" aria-label="Twitter"><svg class="icon"><use xlink:href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/martinkaptein/" aria-label="Instagram"><svg class="icon"><use xlink:href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://linkedin.com/in/martin-kaptein-a26661159" aria-label="LinkedIn"><svg class="icon"><use xlink:href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://www.youtube.com/channel/UCosUIzMUriRTgg60vh3EwCQ" aria-label="Youtube"><svg class="icon"><use xlink:href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/svg/svg-map.svg#youtube"/></svg></a></div><div class="footer__copyright">copyright 2019 Martin Kaptein</div></footer></div><script defer="defer" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/js/jquery-3.2.1.slim.min.js?v=5f48fc77cac90c4778fa24ec9c57f37d"></script><script defer="defer" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/js/scripts.min.js?v=5dffffceea1fdc07740088873ba7ff09"></script><script defer="defer" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/js/svg2js.js?v=6d8344c8e662976649fd775b9a234f87"></script><script defer="defer" src="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/assets/js/svg-fix.js?v=7c0d2bb7276904b382e80bf2d85e8a96"></script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>This website uses cookies and Google Analytics</h2><p>Select which cookies to opt-in to via the checkboxes below; our website uses cookies and Google Analytics to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. This website uses cookies to ensure you get the best experience on our site and to provide a comment feature. To analyze our traffic, we use basic Google Analytics implementation with anonymized data. If you continue without changing your settings, we'll assume that you are happy to receive all cookies on the website of Martin Kaptein. To understand more about how we use cookies, or for information on how to change your cookie settings, please see our Privacy Policy. <a href="file:///Users/mkaptein172/Documents/Publii/sites/martin-kaptein/preview/privacy-policy/index.html">More details...</a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Required</label> <input id="gdpr-functions" name="gdpr-functions" type="checkbox"> <label for="gdpr-functions">Functionality</label> <input id="gdpr-analytics" name="gdpr-analytics" type="checkbox"> <label for="gdpr-analytics">Analytical</label> <input id="gdpr-marketing" name="gdpr-marketing" type="checkbox"> <label for="gdpr-marketing">Marketing</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Save</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>